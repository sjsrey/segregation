<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>segregation.aspatial.aspatial_indexes &#8212; segregation v1.5.0 Manual</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/pysal-styles.css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/pysal_favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../../_static/js/jquery-1.12.4.min.js "></script>
<script type="text/javascript" src="../../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../../_static/bootstrap-3.4.1/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../index.html">
          segregation</a>
        <span class="navbar-text navbar-version pull-left"><b>1.5.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../../installation.html">Installation</a></li>
                <li><a href="../../../api.html">API</a></li>
                <li><a href="../../../references.html">References</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../references.html">References</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for segregation.aspatial.aspatial_indexes</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Aspatial based Segregation Metrics</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Renan X. Cortes &lt;renanc@ucr.edu&gt;, Sergio J. Rey &lt;sergio.rey@ucr.edu&gt; and Elijah Knaap &lt;elijah.knaap@ucr.edu&gt;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>

<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>

<span class="kn">from</span> <span class="nn">segregation.util.util</span> <span class="kn">import</span> <span class="n">_dep_message</span><span class="p">,</span> <span class="n">DeprecationHelper</span><span class="p">,</span> <span class="n">_nan_handle</span>

<span class="c1"># Including old and new api in __all__ so users can use both</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Dissim&#39;</span><span class="p">,</span> 
           
           <span class="s1">&#39;Gini_Seg&#39;</span><span class="p">,</span>
           <span class="s1">&#39;GiniSeg&#39;</span><span class="p">,</span>
           
           <span class="s1">&#39;Entropy&#39;</span><span class="p">,</span> 
           <span class="s1">&#39;Isolation&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Exposure&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Atkinson&#39;</span><span class="p">,</span>
           
           <span class="s1">&#39;Correlation_R&#39;</span><span class="p">,</span>
           <span class="s1">&#39;CorrelationR&#39;</span><span class="p">,</span>
           
           <span class="s1">&#39;Con_Prof&#39;</span><span class="p">,</span>
           <span class="s1">&#39;ConProf&#39;</span><span class="p">,</span>
           
           <span class="s1">&#39;Modified_Dissim&#39;</span><span class="p">,</span>
           <span class="s1">&#39;ModifiedDissim&#39;</span><span class="p">,</span>
           
           <span class="s1">&#39;Modified_Gini_Seg&#39;</span><span class="p">,</span>
           <span class="s1">&#39;ModifiedGiniSeg&#39;</span><span class="p">,</span>
           
           <span class="s1">&#39;Bias_Corrected_Dissim&#39;</span><span class="p">,</span>
           <span class="s1">&#39;BiasCorrectedDissim&#39;</span><span class="p">,</span>
           
           <span class="s1">&#39;Density_Corrected_Dissim&#39;</span><span class="p">,</span>
           <span class="s1">&#39;DensityCorrectedDissim&#39;</span><span class="p">,</span>
           
           <span class="s1">&#39;MinMax&#39;</span><span class="p">]</span>

<span class="c1"># The Deprecation calls of the classes are located in the end of this script #</span>



<span class="k">def</span> <span class="nf">_min_max</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculation of the Aspatial version of SpatialMinMax</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>

<span class="sd">    statistic : float</span>
<span class="sd">                MinMax Index</span>
<span class="sd">                </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Based on O&#39;Sullivan &amp; Wong (2007). A Surface‚ÄêBased Approach to Measuring Spatial Segregation.</span>
<span class="sd">    Geographical Analysis 39 (2). https://doi.org/10.1111/j.1538-4632.2007.00699.x</span>

<span class="sd">    Reference: :cite:`osullivanwong2007surface`.</span>
<span class="sd">    </span>
<span class="sd">    We&#39;d like to thank @AnttiHaerkoenen for this contribution!</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span><span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">group_pop_var</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">total_pop_var</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;group_pop_var and total_pop_var must be strings&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">((</span><span class="n">group_pop_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">total_pop_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>    
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;group_pop_var and total_pop_var must be variables of data&#39;</span><span class="p">)</span>
        
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">group_pop_var</span><span class="p">:</span> <span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> 
                                <span class="n">total_pop_var</span><span class="p">:</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">})</span>
    
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">total_pop_var</span> <span class="o">&lt;</span> <span class="n">data</span><span class="o">.</span><span class="n">group_pop_var</span><span class="p">):</span>    
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Group of interest population must equal or lower than the total population of the units.&#39;</span><span class="p">)</span>
   
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;group_2_pop_var&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;total_pop_var&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">]</span>
    
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;group_1_pop_var_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;group_2_pop_var_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;group_2_pop_var&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;group_2_pop_var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    
    <span class="n">density_1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;group_1_pop_var_norm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">density_2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;group_2_pop_var_norm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">densities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span>
        <span class="n">density_1</span><span class="p">,</span>
        <span class="n">density_2</span>
    <span class="p">])</span>
    <span class="n">v_union</span> <span class="o">=</span> <span class="n">densities</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">v_intersect</span> <span class="o">=</span> <span class="n">densities</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    
    <span class="n">MM</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">v_intersect</span> <span class="o">/</span> <span class="n">v_union</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">]]</span>
    
    <span class="k">else</span><span class="p">:</span>    
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
    
    <span class="k">return</span> <span class="n">MM</span><span class="p">,</span> <span class="n">core_data</span>


<div class="viewcode-block" id="MinMax"><a class="viewcode-back" href="../../../generated/segregation.aspatial.MinMax.html#segregation.aspatial.MinMax">[docs]</a><span class="k">class</span> <span class="nc">MinMax</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculation of the Aspatial version of SpatialMinMax</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    statistic : float</span>
<span class="sd">                MinMax Index</span>
<span class="sd">                </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Based on O&#39;Sullivan &amp; Wong (2007). A Surface‚ÄêBased Approach to Measuring Spatial Segregation.</span>
<span class="sd">    Geographical Analysis 39 (2). https://doi.org/10.1111/j.1538-4632.2007.00699.x</span>

<span class="sd">    Reference: :cite:`osullivanwong2007surface`.</span>
<span class="sd">    </span>
<span class="sd">    We&#39;d like to thank @AnttiHaerkoenen for this contribution!</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MinMax.__init__"><a class="viewcode-back" href="../../../generated/segregation.aspatial.MinMax.html#segregation.aspatial.MinMax.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">_geometry_column_name</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">]])</span>
        
        <span class="n">aux</span> <span class="o">=</span> <span class="n">_min_max</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statistic</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_function</span> <span class="o">=</span> <span class="n">_min_max</span></div></div>





<span class="k">def</span> <span class="nf">_dissim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculation of Dissimilarity index</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>

<span class="sd">    statistic : float</span>
<span class="sd">                Dissimilarity Index</span>
<span class="sd">                </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Based on Massey, Douglas S., and Nancy A. Denton. &quot;The dimensions of residential segregation.&quot; Social forces 67.2 (1988): 281-315.</span>

<span class="sd">    Reference: :cite:`massey1988dimensions`.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span><span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">group_pop_var</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">total_pop_var</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;group_pop_var and total_pop_var must be strings&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">((</span><span class="n">group_pop_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">total_pop_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>    
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;group_pop_var and total_pop_var must be variables of data&#39;</span><span class="p">)</span>
        
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">group_pop_var</span><span class="p">:</span> <span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> 
                                <span class="n">total_pop_var</span><span class="p">:</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">})</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">group_pop_var</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">total_pop_var</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">):</span>    
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Group of interest population must equal or lower than the total population of the units.&#39;</span><span class="p">)</span>
   
    <span class="n">T</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">T</span>
    
    <span class="c1"># If a unit has zero population, the group of interest frequency is zero</span>
    <span class="n">pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span> <span class="o">/</span> <span class="n">t</span><span class="p">)</span>
    
    <span class="n">D</span> <span class="o">=</span> <span class="p">(((</span><span class="n">t</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pi</span> <span class="o">-</span> <span class="n">P</span><span class="p">)))</span><span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">T</span> <span class="o">*</span> <span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">P</span><span class="p">)))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">!=</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">]]</span>
    
    <span class="k">else</span><span class="p">:</span>    
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
    
    <span class="k">return</span> <span class="n">D</span><span class="p">,</span> <span class="n">core_data</span>


<div class="viewcode-block" id="Dissim"><a class="viewcode-back" href="../../../generated/segregation.aspatial.Dissim.html#segregation.aspatial.Dissim">[docs]</a><span class="k">class</span> <span class="nc">Dissim</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Classic Dissimilarity Index</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    statistic : float</span>
<span class="sd">                Dissimilarity Index</span>
<span class="sd">        </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate. </span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    In this example, we will calculate the degree of dissimilarity (D) for the Riverside County using the census tract data of 2010.</span>
<span class="sd">    The group of interest is non-hispanic black people which is the variable nhblk10 in the dataset.</span>
<span class="sd">    </span>
<span class="sd">    Firstly, we need to perform some import the modules and the respective function.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; import geopandas as gpd</span>
<span class="sd">    &gt;&gt;&gt; import segregation</span>
<span class="sd">    &gt;&gt;&gt; from segregation.aspatial import Dissim</span>
<span class="sd">    </span>
<span class="sd">    Secondly, we need to read the data:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; # This example uses all census data that the user must provide your own copy of the external database.</span>
<span class="sd">    &gt;&gt;&gt; # A step-by-step procedure for downloading the data can be found here: https://github.com/spatialucr/geosnap/blob/master/examples/01_getting_started.ipynb</span>
<span class="sd">    &gt;&gt;&gt; # After the user download the LTDB_Std_All_fullcount.zip and extract the files, the filepath might be something like presented below.</span>
<span class="sd">    &gt;&gt;&gt; filepath = &#39;~/data/LTDB_Std_2010_fullcount.csv&#39;</span>
<span class="sd">    &gt;&gt;&gt; census_2010 = pd.read_csv(filepath, encoding = &quot;ISO-8859-1&quot;, sep = &quot;,&quot;)</span>
<span class="sd">    </span>
<span class="sd">    Then, we filter only for the desired county (in this case, Riverside County):</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; df = census_2010.loc[census_2010.county == &quot;Riverside County&quot;][[&#39;pop10&#39;,&#39;tractid&#39;]]</span>
<span class="sd">    </span>
<span class="sd">    The value is estimated below.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; dissim_index = Dissim(df, &#39;tractid&#39;, &#39;pop10&#39;)</span>
<span class="sd">    &gt;&gt;&gt; dissim_index.statistic</span>
<span class="sd">    0.31565682496226544</span>
<span class="sd">    </span>
<span class="sd">    The interpretation of this value is that 31.57% of the non-hispanic black population would have to move to reach eveness in the Riverside County.</span>
<span class="sd">        </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Based on Massey, Douglas S., and Nancy A. Denton. &quot;The dimensions of residential segregation.&quot; Social forces 67.2 (1988): 281-315.</span>
<span class="sd">    </span>
<span class="sd">    Reference: :cite:`massey1988dimensions`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Dissim.__init__"><a class="viewcode-back" href="../../../generated/segregation.aspatial.Dissim.html#segregation.aspatial.Dissim.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">):</span>        
        
        <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">_geometry_column_name</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">]])</span>
        
        <span class="n">aux</span> <span class="o">=</span> <span class="n">_dissim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statistic</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_function</span> <span class="o">=</span> <span class="n">_dissim</span></div></div>
        
        
        
<span class="k">def</span> <span class="nf">_gini_seg</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculation of Gini Segregation index</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>
<span class="sd">                    </span>
<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    statistic : float</span>
<span class="sd">                Gini Segregation Index</span>
<span class="sd">                </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate. </span>
<span class="sd">                </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Based on Massey, Douglas S., and Nancy A. Denton. &quot;The dimensions of residential segregation.&quot; Social forces 67.2 (1988): 281-315.</span>
<span class="sd">    </span>
<span class="sd">    Reference: :cite:`massey1988dimensions`.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span><span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">group_pop_var</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">total_pop_var</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;group_pop_var and total_pop_var must be strings&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">((</span><span class="n">group_pop_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">total_pop_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>    
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;group_pop_var and total_pop_var must be variables of data&#39;</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">group_pop_var</span><span class="p">:</span> <span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> 
                                <span class="n">total_pop_var</span><span class="p">:</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">})</span>
    
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">total_pop_var</span> <span class="o">&lt;</span> <span class="n">data</span><span class="o">.</span><span class="n">group_pop_var</span><span class="p">):</span>    
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Group of interest population must equal or lower than the total population of the units.&#39;</span><span class="p">)</span>
   
    <span class="n">T</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">total_pop_var</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">group_pop_var</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">T</span>
    
    <span class="c1"># If a unit has zero population, the group of interest frequency is zero</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">ti</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">total_pop_var</span><span class="p">,</span>
                       <span class="n">pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">total_pop_var</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">group_pop_var</span><span class="o">/</span><span class="n">data</span><span class="o">.</span><span class="n">total_pop_var</span><span class="p">))</span>
    
    <span class="n">num</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ti</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ti</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">pi</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">pi</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">den</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">P</span><span class="p">))</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">num</span> <span class="o">/</span> <span class="n">den</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">!=</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">]]</span>
    
    <span class="k">else</span><span class="p">:</span>    
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
    
    <span class="k">return</span> <span class="n">G</span><span class="p">,</span> <span class="n">core_data</span>


<div class="viewcode-block" id="GiniSeg"><a class="viewcode-back" href="../../../generated/segregation.aspatial.GiniSeg.html#segregation.aspatial.GiniSeg">[docs]</a><span class="k">class</span> <span class="nc">GiniSeg</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Classic Gini Segregation Index</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    statistic : float</span>
<span class="sd">                Gini Segregation Index</span>
<span class="sd">                </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate. </span>
<span class="sd">                </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    In this example, we will calculate the Gini Segregation Index (G) for the Riverside County using the census tract data of 2010.</span>
<span class="sd">    The group of interest is non-hispanic black people which is the variable nhblk10 in the dataset.</span>
<span class="sd">    </span>
<span class="sd">    Firstly, we need to perform some import the modules and the respective function.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; import geopandas as gpd</span>
<span class="sd">    &gt;&gt;&gt; import segregation</span>
<span class="sd">    &gt;&gt;&gt; from segregation.aspatial import GiniSeg</span>
<span class="sd">    </span>
<span class="sd">    Secondly, we need to read the data:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; # This example uses all census data that the user must provide your own copy of the external database.</span>
<span class="sd">    &gt;&gt;&gt; # A step-by-step procedure for downloading the data can be found here: https://github.com/spatialucr/geosnap/blob/master/examples/01_getting_started.ipynb</span>
<span class="sd">    &gt;&gt;&gt; # After the user download the LTDB_Std_All_fullcount.zip and extract the files, the filepath might be something like presented below.</span>
<span class="sd">    &gt;&gt;&gt; filepath = &#39;~/data/LTDB_Std_2010_fullcount.csv&#39;</span>
<span class="sd">    &gt;&gt;&gt; census_2010 = pd.read_csv(filepath, encoding = &quot;ISO-8859-1&quot;, sep = &quot;,&quot;)</span>
<span class="sd">    </span>
<span class="sd">    Then, we filter only for the desired county (in this case, Riverside County):</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; df = census_2010.loc[census_2010.county == &quot;Riverside County&quot;][[&#39;pop10&#39;,&#39;tractid&#39;]]</span>
<span class="sd">    </span>
<span class="sd">    The value is estimated below.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; gini_seg_index = GiniSeg(df, &#39;tractid&#39;, &#39;pop10&#39;)</span>
<span class="sd">    &gt;&gt;&gt; gini_seg_index.statistic</span>
<span class="sd">    0.44620350030600087</span>
<span class="sd">       </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Based on Massey, Douglas S., and Nancy A. Denton. &quot;The dimensions of residential segregation.&quot; Social forces 67.2 (1988): 281-315.</span>
<span class="sd">    </span>
<span class="sd">    Reference: :cite:`massey1988dimensions`.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="GiniSeg.__init__"><a class="viewcode-back" href="../../../generated/segregation.aspatial.GiniSeg.html#segregation.aspatial.GiniSeg.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">):</span>        
        
        <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">_geometry_column_name</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">]])</span>
        
        <span class="n">aux</span> <span class="o">=</span> <span class="n">_gini_seg</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statistic</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_function</span> <span class="o">=</span> <span class="n">_gini_seg</span></div></div>
        
        
        
<span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculation of Entropy index</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>

<span class="sd">    statistic : float</span>
<span class="sd">                Entropy Index</span>
<span class="sd">                </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate. </span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Based on Massey, Douglas S., and Nancy A. Denton. &quot;The dimensions of residential segregation.&quot; Social forces 67.2 (1988): 281-315.</span>
<span class="sd">    </span>
<span class="sd">    Reference: :cite:`massey1988dimensions`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span><span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">group_pop_var</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">total_pop_var</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;group_pop_var and total_pop_var must be strings&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">((</span><span class="n">group_pop_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">total_pop_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>    
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;group_pop_var and total_pop_var must be variables of data&#39;</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">group_pop_var</span><span class="p">:</span> <span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> 
                                <span class="n">total_pop_var</span><span class="p">:</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">})</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">group_pop_var</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">total_pop_var</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">):</span>    
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Group of interest population must equal or lower than the total population of the units.&#39;</span><span class="p">)</span>
   
    <span class="n">T</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">T</span>
    
    <span class="c1"># If a unit has zero population, the group of interest frequency is zero</span>
    <span class="n">pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span> <span class="o">/</span> <span class="n">t</span><span class="p">)</span>
    
    <span class="n">E</span> <span class="o">=</span> <span class="n">P</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">P</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">P</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">P</span><span class="p">))</span>
    <span class="n">Ei</span> <span class="o">=</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pi</span><span class="p">))</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">E</span> <span class="o">-</span> <span class="n">Ei</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">E</span> <span class="o">*</span> <span class="n">T</span><span class="p">))</span> <span class="c1"># If some pi is zero, numpy will treat as zero</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">!=</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">]]</span>
    
    <span class="k">else</span><span class="p">:</span>    
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
    
    <span class="k">return</span> <span class="n">H</span><span class="p">,</span> <span class="n">core_data</span>


<div class="viewcode-block" id="Entropy"><a class="viewcode-back" href="../../../generated/segregation.aspatial.Entropy.html#segregation.aspatial.Entropy">[docs]</a><span class="k">class</span> <span class="nc">Entropy</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Classic Entropy Index</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    statistic : float</span>
<span class="sd">                Entropy Index</span>
<span class="sd">                </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate. </span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    In this example, we will calculate the Entropy (H) for the Riverside County using the census tract data of 2010.</span>
<span class="sd">    The group of interest is non-hispanic black people which is the variable nhblk10 in the dataset.</span>
<span class="sd">    </span>
<span class="sd">    Firstly, we need to perform some import the modules and the respective function.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; import geopandas as gpd</span>
<span class="sd">    &gt;&gt;&gt; import segregation</span>
<span class="sd">    &gt;&gt;&gt; from segregation.aspatial import Entropy</span>
<span class="sd">    </span>
<span class="sd">    Secondly, we need to read the data:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; # This example uses all census data that the user must provide your own copy of the external database.</span>
<span class="sd">    &gt;&gt;&gt; # A step-by-step procedure for downloading the data can be found here: https://github.com/spatialucr/geosnap/blob/master/examples/01_getting_started.ipynb</span>
<span class="sd">    &gt;&gt;&gt; # After the user download the LTDB_Std_All_fullcount.zip and extract the files, the filepath might be something like presented below.</span>
<span class="sd">    &gt;&gt;&gt; filepath = &#39;~/data/LTDB_Std_2010_fullcount.csv&#39;</span>
<span class="sd">    &gt;&gt;&gt; census_2010 = pd.read_csv(filepath, encoding = &quot;ISO-8859-1&quot;, sep = &quot;,&quot;)</span>
<span class="sd">    </span>
<span class="sd">    Then, we filter only for the desired county (in this case, Riverside County):</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; df = census_2010.loc[census_2010.county == &quot;Riverside County&quot;][[&#39;pop10&#39;,&#39;tractid&#39;]]</span>
<span class="sd">    </span>
<span class="sd">    The value is estimated below.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; entropy_index = Entropy(df, &#39;tractid&#39;, &#39;pop10&#39;)</span>
<span class="sd">    &gt;&gt;&gt; entropy_index.statistic</span>
<span class="sd">    0.08636489348167173</span>
<span class="sd">       </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Based on Massey, Douglas S., and Nancy A. Denton. &quot;The dimensions of residential segregation.&quot; Social forces 67.2 (1988): 281-315.</span>

<span class="sd">    Reference: :cite:`massey1988dimensions`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Entropy.__init__"><a class="viewcode-back" href="../../../generated/segregation.aspatial.Entropy.html#segregation.aspatial.Entropy.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">):</span>        
        
        <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">_geometry_column_name</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">]])</span>
        
        <span class="n">aux</span> <span class="o">=</span> <span class="n">_entropy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statistic</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_function</span> <span class="o">=</span> <span class="n">_entropy</span></div></div>
        
        
        
        
<span class="k">def</span> <span class="nf">_isolation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculation of Isolation index</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest (X)</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>

<span class="sd">    statistic : float</span>
<span class="sd">                Isolation Index</span>
<span class="sd">                </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate. </span>
<span class="sd">                </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The group of interest is labelled as group X.</span>
<span class="sd">    </span>
<span class="sd">    Based on Massey, Douglas S., and Nancy A. Denton. &quot;The dimensions of residential segregation.&quot; Social forces 67.2 (1988): 281-315.</span>
<span class="sd">    </span>
<span class="sd">    Reference: :cite:`massey1988dimensions`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span><span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">group_pop_var</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">total_pop_var</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;group_pop_var and total_pop_var must be strings&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">((</span><span class="n">group_pop_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">total_pop_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>    
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;group_pop_var and total_pop_var must be variables of data&#39;</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">group_pop_var</span><span class="p">:</span> <span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> 
                                <span class="n">total_pop_var</span><span class="p">:</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">})</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">group_pop_var</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">total_pop_var</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">):</span>    
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Group of interest population must equal or lower than the total population of the units.&#39;</span><span class="p">)</span>
   
    <span class="n">X</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">xPx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">((</span><span class="n">x</span> <span class="o">/</span> <span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">t</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">!=</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">]]</span>
    
    <span class="k">else</span><span class="p">:</span>    
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
    
    <span class="k">return</span> <span class="n">xPx</span><span class="p">,</span> <span class="n">core_data</span>


<div class="viewcode-block" id="Isolation"><a class="viewcode-back" href="../../../generated/segregation.aspatial.Isolation.html#segregation.aspatial.Isolation">[docs]</a><span class="k">class</span> <span class="nc">Isolation</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Classic Isolation Index</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest (X)</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    statistic : float</span>
<span class="sd">                Isolation Index</span>
<span class="sd">                </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate.   </span>
<span class="sd">                </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    In this example, we will calculate the Isolation Index (xPx) for the Riverside County using the census tract data of 2010.</span>
<span class="sd">    The group of interest is non-hispanic black people which is the variable nhblk10 in the dataset.</span>
<span class="sd">    </span>
<span class="sd">    Firstly, we need to perform some import the modules and the respective function.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; import geopandas as gpd</span>
<span class="sd">    &gt;&gt;&gt; import segregation</span>
<span class="sd">    &gt;&gt;&gt; from segregation.aspatial import Isolation</span>
<span class="sd">    </span>
<span class="sd">    Secondly, we need to read the data:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; # This example uses all census data that the user must provide your own copy of the external database.</span>
<span class="sd">    &gt;&gt;&gt; # A step-by-step procedure for downloading the data can be found here: https://github.com/spatialucr/geosnap/blob/master/examples/01_getting_started.ipynb</span>
<span class="sd">    &gt;&gt;&gt; # After the user download the LTDB_Std_All_fullcount.zip and extract the files, the filepath might be something like presented below.</span>
<span class="sd">    &gt;&gt;&gt; filepath = &#39;~/data/LTDB_Std_2010_fullcount.csv&#39;</span>
<span class="sd">    &gt;&gt;&gt; census_2010 = pd.read_csv(filepath, encoding = &quot;ISO-8859-1&quot;, sep = &quot;,&quot;)</span>
<span class="sd">    </span>
<span class="sd">    Then, we filter only for the desired county (in this case, Riverside County):</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; df = census_2010.loc[census_2010.county == &quot;Riverside County&quot;][[&#39;pop10&#39;,&#39;tractid&#39;]]</span>
<span class="sd">    </span>
<span class="sd">    The value is estimated below.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; isolation_index = Isolation(df, &#39;tractid&#39;, &#39;pop10&#39;)</span>
<span class="sd">    &gt;&gt;&gt; isolation_index.statistic</span>
<span class="sd">    0.11321482777341298</span>
<span class="sd">    </span>
<span class="sd">    The interpretation of this number is that if you randomly pick a X member of a specific area, there is 11.32% of probability that this member shares a unit with another X member.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The group of interest is labelled as group X.</span>
<span class="sd">    </span>
<span class="sd">    Based on Massey, Douglas S., and Nancy A. Denton. &quot;The dimensions of residential segregation.&quot; Social forces 67.2 (1988): 281-315.</span>
<span class="sd">    </span>
<span class="sd">    Reference: :cite:`massey1988dimensions`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Isolation.__init__"><a class="viewcode-back" href="../../../generated/segregation.aspatial.Isolation.html#segregation.aspatial.Isolation.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">):</span>        
        
        <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">_geometry_column_name</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">]])</span>
        
        <span class="n">aux</span> <span class="o">=</span> <span class="n">_isolation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statistic</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_function</span> <span class="o">=</span> <span class="n">_isolation</span></div></div>
        
        
        
<span class="k">def</span> <span class="nf">_exposure</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculation of Exposure index</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest (X)</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>

<span class="sd">    statistic : float</span>
<span class="sd">                Exposure Index</span>
<span class="sd">                </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate. </span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The group of interest is labelled as group X, whilst Y is the complementary group. Groups X and Y are mutually excludent.</span>
<span class="sd">    </span>
<span class="sd">    Based on Massey, Douglas S., and Nancy A. Denton. &quot;The dimensions of residential segregation.&quot; Social forces 67.2 (1988): 281-315.</span>
<span class="sd">    </span>
<span class="sd">    Reference: :cite:`massey1988dimensions`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span><span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">group_pop_var</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">total_pop_var</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;group_pop_var and total_pop_var must be strings&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">((</span><span class="n">group_pop_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">total_pop_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>    
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;group_pop_var and total_pop_var must be variables of data&#39;</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">group_pop_var</span><span class="p">:</span> <span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> 
                                <span class="n">total_pop_var</span><span class="p">:</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">})</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">group_pop_var</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">total_pop_var</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">):</span>    
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Group of interest population must equal or lower than the total population of the units.&#39;</span><span class="p">)</span>
   
    <span class="n">yi</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">x</span>
    
    <span class="n">X</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">xPy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">((</span><span class="n">x</span> <span class="o">/</span> <span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">yi</span> <span class="o">/</span> <span class="n">t</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">!=</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">]]</span>
    
    <span class="k">else</span><span class="p">:</span>    
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
    
    <span class="k">return</span> <span class="n">xPy</span><span class="p">,</span> <span class="n">core_data</span>


<div class="viewcode-block" id="Exposure"><a class="viewcode-back" href="../../../generated/segregation.aspatial.Exposure.html#segregation.aspatial.Exposure">[docs]</a><span class="k">class</span> <span class="nc">Exposure</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Classic Exposure Index</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest (X)</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    statistic : float</span>
<span class="sd">                Exposure Index</span>

<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate. </span>
<span class="sd">                </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    In this example, we will calculate the Exposure Index (xPy) for the Riverside County using the census tract data of 2010.</span>
<span class="sd">    The group of interest (X) is non-hispanic black people which is the variable nhblk10 in the dataset and the Y group is the other part of the population.</span>
<span class="sd">    </span>
<span class="sd">    Firstly, we need to perform some import the modules and the respective function.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; import geopandas as gpd</span>
<span class="sd">    &gt;&gt;&gt; import segregation</span>
<span class="sd">    &gt;&gt;&gt; from segregation.aspatial import Exposure</span>
<span class="sd">    </span>
<span class="sd">    Secondly, we need to read the data:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; # This example uses all census data that the user must provide your own copy of the external database.</span>
<span class="sd">    &gt;&gt;&gt; # A step-by-step procedure for downloading the data can be found here: https://github.com/spatialucr/geosnap/blob/master/examples/01_getting_started.ipynb</span>
<span class="sd">    &gt;&gt;&gt; # After the user download the LTDB_Std_All_fullcount.zip and extract the files, the filepath might be something like presented below.</span>
<span class="sd">    &gt;&gt;&gt; filepath = &#39;~/data/LTDB_Std_2010_fullcount.csv&#39;</span>
<span class="sd">    &gt;&gt;&gt; census_2010 = pd.read_csv(filepath, encoding = &quot;ISO-8859-1&quot;, sep = &quot;,&quot;)</span>
<span class="sd">    </span>
<span class="sd">    Then, we filter only for the desired county (in this case, Riverside County):</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; df = census_2010.loc[census_2010.county == &quot;Riverside County&quot;][[&#39;pop10&#39;,&#39;tractid&#39;]]</span>
<span class="sd">    </span>
<span class="sd">    The value is estimated below.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; exposure_index = Exposure(df, &#39;tractid&#39;, &#39;pop10&#39;)</span>
<span class="sd">    &gt;&gt;&gt; exposure_index.statistic</span>
<span class="sd">    0.886785172226587</span>
<span class="sd">    </span>
<span class="sd">    The interpretation of this number is that if you randomly pick a X member of a specific area, there is 88.68% of probability that this member shares a unit with a Y member.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The group of interest is labelled as group X, whilst Y is the complementary group. Groups X and Y are mutually excludent.</span>
<span class="sd">    </span>
<span class="sd">    Based on Massey, Douglas S., and Nancy A. Denton. &quot;The dimensions of residential segregation.&quot; Social forces 67.2 (1988): 281-315.</span>
<span class="sd">    </span>
<span class="sd">    Reference: :cite:`massey1988dimensions`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Exposure.__init__"><a class="viewcode-back" href="../../../generated/segregation.aspatial.Exposure.html#segregation.aspatial.Exposure.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">):</span>        
        
        <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">_geometry_column_name</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">]])</span>
        
        <span class="n">aux</span> <span class="o">=</span> <span class="n">_exposure</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statistic</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_function</span> <span class="o">=</span> <span class="n">_exposure</span></div></div>




<span class="k">def</span> <span class="nf">_atkinson</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculation of Atkinson index</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>
<span class="sd">                    </span>
<span class="sd">    b             : float</span>
<span class="sd">                    The shape parameter, between 0 and 1, that determines how to weight the increments to segregation contributed by different portions of the Lorenz curve.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>

<span class="sd">    statistic : float</span>
<span class="sd">                Atkinson Index</span>
<span class="sd">    </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Based on Massey, Douglas S., and Nancy A. Denton. &quot;The dimensions of residential segregation.&quot; Social forces 67.2 (1988): 281-315.</span>
<span class="sd">    </span>
<span class="sd">    Reference: :cite:`massey1988dimensions`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The parameter b must be a float.&#39;</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="p">((</span><span class="n">b</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The parameter b must be between 0 and 1.&#39;</span><span class="p">)</span>
        
    <span class="k">if</span><span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">group_pop_var</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">total_pop_var</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;group_pop_var and total_pop_var must be strings&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">((</span><span class="n">group_pop_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">total_pop_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>    
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;group_pop_var and total_pop_var must be variables of data&#39;</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">group_pop_var</span><span class="p">:</span> <span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> 
                                <span class="n">total_pop_var</span><span class="p">:</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">})</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">group_pop_var</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">total_pop_var</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">):</span>    
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Group of interest population must equal or lower than the total population of the units.&#39;</span><span class="p">)</span>
   
    <span class="n">T</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">T</span>
    
    <span class="c1"># If a unit has zero population, the group of interest frequency is zero</span>
    <span class="n">pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span> <span class="o">/</span> <span class="n">t</span><span class="p">)</span>
    
    <span class="n">A</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">P</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">P</span><span class="p">))</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">((((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">**</span> <span class="n">b</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="n">T</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">b</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">!=</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">]]</span>
    
    <span class="k">else</span><span class="p">:</span>    
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
    
    <span class="k">return</span> <span class="n">A</span><span class="p">,</span> <span class="n">core_data</span>


<div class="viewcode-block" id="Atkinson"><a class="viewcode-back" href="../../../generated/segregation.aspatial.Atkinson.html#segregation.aspatial.Atkinson">[docs]</a><span class="k">class</span> <span class="nc">Atkinson</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Classic Atkinson Index</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>

<span class="sd">    b             : float</span>
<span class="sd">                    The shape parameter, between 0 and 1, that determines how to weight the increments to segregation contributed by different portions of the Lorenz curve.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    statistic : float</span>
<span class="sd">                Atkison Index</span>
<span class="sd">    </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">            A pandas DataFrame that contains the columns used to perform the estimate.</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    In this example, we will calculate the Atkinson Index (A) with the shape parameter (b) equals to 0.5 for the Riverside County using the census tract data of 2010.</span>
<span class="sd">    The group of interest is non-hispanic black people which is the variable nhblk10 in the dataset.</span>
<span class="sd">    </span>
<span class="sd">    Firstly, we need to perform some import the modules and the respective function.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; import geopandas as gpd</span>
<span class="sd">    &gt;&gt;&gt; import segregation</span>
<span class="sd">    &gt;&gt;&gt; from segregation.aspatial import Atkinson</span>
<span class="sd">    </span>
<span class="sd">    Secondly, we need to read the data:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; # This example uses all census data that the user must provide your own copy of the external database.</span>
<span class="sd">    &gt;&gt;&gt; # A step-by-step procedure for downloading the data can be found here: https://github.com/spatialucr/geosnap/blob/master/examples/01_getting_started.ipynb</span>
<span class="sd">    &gt;&gt;&gt; # After the user download the LTDB_Std_All_fullcount.zip and extract the files, the filepath might be something like presented below.</span>
<span class="sd">    &gt;&gt;&gt; filepath = &#39;~/data/LTDB_Std_2010_fullcount.csv&#39;</span>
<span class="sd">    &gt;&gt;&gt; census_2010 = pd.read_csv(filepath, encoding = &quot;ISO-8859-1&quot;, sep = &quot;,&quot;)</span>
<span class="sd">    </span>
<span class="sd">    Then, we filter only for the desired county (in this case, Riverside County):</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; df = census_2010.loc[census_2010.county == &quot;Riverside County&quot;][[&#39;pop10&#39;,&#39;tractid&#39;]]</span>
<span class="sd">    </span>
<span class="sd">    The value is estimated below.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; atkinson_index = Atkinson(df, &#39;tractid&#39;, &#39;pop10&#39;, b = 0.5)</span>
<span class="sd">    &gt;&gt;&gt; atkinson_index.statistic</span>
<span class="sd">    0.16722406110274002</span>
<span class="sd">       </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Based on Massey, Douglas S., and Nancy A. Denton. &quot;The dimensions of residential segregation.&quot; Social forces 67.2 (1988): 281-315.</span>
<span class="sd">    </span>
<span class="sd">    Reference: :cite:`massey1988dimensions`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Atkinson.__init__"><a class="viewcode-back" href="../../../generated/segregation.aspatial.Atkinson.html#segregation.aspatial.Atkinson.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">):</span>        
        
        <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">_geometry_column_name</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">]])</span>
        
        <span class="n">aux</span> <span class="o">=</span> <span class="n">_atkinson</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statistic</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_function</span> <span class="o">=</span> <span class="n">_atkinson</span></div></div>
        
        
        
<span class="k">def</span> <span class="nf">_correlationr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculation of Correlation Ratio index</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest (X)</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>

<span class="sd">    statistic : float</span>
<span class="sd">                Correlation Ratio Index</span>
<span class="sd">                </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate. </span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    </span>
<span class="sd">    Based on Massey, Douglas S., and Nancy A. Denton. &quot;The dimensions of residential segregation.&quot; Social forces 67.2 (1988): 281-315.</span>
<span class="sd">    </span>
<span class="sd">    Reference: :cite:`massey1988dimensions`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span><span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">group_pop_var</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">total_pop_var</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;group_pop_var and total_pop_var must be strings&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">((</span><span class="n">group_pop_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">total_pop_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>    
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;group_pop_var and total_pop_var must be variables of data&#39;</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">group_pop_var</span><span class="p">:</span> <span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> 
                                <span class="n">total_pop_var</span><span class="p">:</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">})</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">group_pop_var</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">total_pop_var</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">):</span>    
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Group of interest population must equal or lower than the total population of the units.&#39;</span><span class="p">)</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">X</span> <span class="o">/</span> <span class="n">T</span>
    
    <span class="n">xPx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">((</span><span class="n">x</span> <span class="o">/</span> <span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">t</span><span class="p">))</span>

    <span class="n">V</span> <span class="o">=</span> <span class="p">(</span><span class="n">xPx</span> <span class="o">-</span> <span class="n">P</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">P</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">!=</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">]]</span>
    
    <span class="k">else</span><span class="p">:</span>    
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
    
    <span class="k">return</span> <span class="n">V</span><span class="p">,</span> <span class="n">core_data</span>


<div class="viewcode-block" id="CorrelationR"><a class="viewcode-back" href="../../../generated/segregation.aspatial.CorrelationR.html#segregation.aspatial.CorrelationR">[docs]</a><span class="k">class</span> <span class="nc">CorrelationR</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Classic Correlation Ratio Index</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest (X)</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    statistic : float</span>
<span class="sd">                Correlation Ratio Index</span>
<span class="sd">                </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate. </span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    In this example, we will calculate the Correlation Ratio Index (V) for the Riverside County using the census tract data of 2010.</span>
<span class="sd">    The group of interest is non-hispanic black people which is the variable nhblk10 in the dataset.</span>
<span class="sd">    </span>
<span class="sd">    Firstly, we need to perform some import the modules and the respective function.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; import geopandas as gpd</span>
<span class="sd">    &gt;&gt;&gt; import segregation</span>
<span class="sd">    &gt;&gt;&gt; from segregation.aspatial import CorrelationR</span>
<span class="sd">    </span>
<span class="sd">    Secondly, we need to read the data:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; # This example uses all census data that the user must provide your own copy of the external database.</span>
<span class="sd">    &gt;&gt;&gt; # A step-by-step procedure for downloading the data can be found here: https://github.com/spatialucr/geosnap/blob/master/examples/01_getting_started.ipynb</span>
<span class="sd">    &gt;&gt;&gt; # After the user download the LTDB_Std_All_fullcount.zip and extract the files, the filepath might be something like presented below.</span>
<span class="sd">    &gt;&gt;&gt; filepath = &#39;~/data/LTDB_Std_2010_fullcount.csv&#39;</span>
<span class="sd">    &gt;&gt;&gt; census_2010 = pd.read_csv(filepath, encoding = &quot;ISO-8859-1&quot;, sep = &quot;,&quot;)</span>
<span class="sd">    </span>
<span class="sd">    Then, we filter only for the desired county (in this case, Riverside County):</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; df = census_2010.loc[census_2010.county == &quot;Riverside County&quot;][[&#39;pop10&#39;,&#39;tractid&#39;]]</span>
<span class="sd">    </span>
<span class="sd">    The value is estimated below.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; correlationr_index = CorrelationR(df, &#39;tractid&#39;, &#39;pop10&#39;)</span>
<span class="sd">    &gt;&gt;&gt; correlationr_index.statistic</span>
<span class="sd">    0.048716810856363923</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    </span>
<span class="sd">    Based on Massey, Douglas S., and Nancy A. Denton. &quot;The dimensions of residential segregation.&quot; Social forces 67.2 (1988): 281-315.</span>
<span class="sd">    </span>
<span class="sd">    Reference: :cite:`massey1988dimensions`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="CorrelationR.__init__"><a class="viewcode-back" href="../../../generated/segregation.aspatial.CorrelationR.html#segregation.aspatial.CorrelationR.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">):</span>        
        
        <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">_geometry_column_name</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">]])</span>
        
        <span class="n">aux</span> <span class="o">=</span> <span class="n">_correlationr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statistic</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_function</span> <span class="o">=</span> <span class="n">_correlationr</span></div></div>
        
        
<span class="k">def</span> <span class="nf">_conprof</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculation of Concentration Profile</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>
<span class="sd">                    </span>
<span class="sd">    m             : int</span>
<span class="sd">                    a numeric value indicating the number of thresholds to be used. Default value is 1000. </span>
<span class="sd">                    A large value of m creates a smoother-looking graph and a more precise concentration profile value but slows down the calculation speed.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>

<span class="sd">    statistic : float</span>
<span class="sd">                Concentration Profile Index</span>
<span class="sd">                </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate. </span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Based on Hong, Seong-Yun, and Yukio Sadahiro. &quot;Measuring geographic segregation: a graph-based approach.&quot; Journal of Geographical Systems 16.2 (2014): 211-231.</span>

<span class="sd">    Reference: :cite:`hong2014measuring`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;m must be a string.&#39;</span><span class="p">)</span>
        
    <span class="k">if</span><span class="p">(</span><span class="n">m</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;m must be greater than 1.&#39;</span><span class="p">)</span>
    
    <span class="k">if</span><span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">group_pop_var</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">total_pop_var</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;group_pop_var and total_pop_var must be strings&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">((</span><span class="n">group_pop_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">total_pop_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>    
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;group_pop_var and total_pop_var must be variables of data&#39;</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">group_pop_var</span><span class="p">:</span> <span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> 
                                <span class="n">total_pop_var</span><span class="p">:</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">})</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">group_pop_var</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">total_pop_var</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">):</span>    
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Group of interest population must equal or lower than the total population of the units.&#39;</span><span class="p">)</span>
   
    <span class="k">def</span> <span class="nf">calculate_vt</span><span class="p">(</span><span class="n">th</span><span class="p">):</span>
        <span class="n">g_t_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="n">th</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">v_t</span> <span class="o">=</span> <span class="p">(</span><span class="n">g_t_i</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">v_t</span>
    
    <span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="n">curve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">calculate_vt</span><span class="p">,</span> <span class="n">grid</span><span class="p">)))</span>
    
    <span class="n">threshold</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">t</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">R</span> <span class="o">=</span> <span class="p">((</span><span class="n">threshold</span> <span class="o">-</span> <span class="p">((</span><span class="n">curve</span><span class="p">[</span><span class="n">grid</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">m</span> <span class="o">-</span> <span class="p">(</span><span class="n">curve</span><span class="p">[</span><span class="n">grid</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span> <span class="n">m</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">threshold</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">!=</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">]]</span>
    
    <span class="k">else</span><span class="p">:</span>    
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
    
    <span class="k">return</span> <span class="n">R</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">core_data</span>


<div class="viewcode-block" id="ConProf"><a class="viewcode-back" href="../../../generated/segregation.aspatial.ConProf.html#segregation.aspatial.ConProf">[docs]</a><span class="k">class</span> <span class="nc">ConProf</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Concentration Profile Index</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>
<span class="sd">                    </span>
<span class="sd">    m             : int</span>
<span class="sd">                    a numeric value indicating the number of thresholds to be used. </span>
<span class="sd">                    A large value of m creates a smoother-looking graph and a more precise concentration profile value but slows down the calculation speed.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    statistic : float</span>
<span class="sd">                Concentration Profile Index</span>
<span class="sd">                </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate. </span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    In this example, we will calculate the concentration profile (R) for the Riverside County using the census tract data of 2010.</span>
<span class="sd">    The group of interest is non-hispanic black people which is the variable nhblk10 in the dataset.</span>
<span class="sd">    </span>
<span class="sd">    Firstly, we need to perform some import the modules and the respective function.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; import geopandas as gpd</span>
<span class="sd">    &gt;&gt;&gt; import segregation</span>
<span class="sd">    &gt;&gt;&gt; from segregation.aspatial import ConProf</span>
<span class="sd">    </span>
<span class="sd">    Secondly, we need to read the data:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; # This example uses all census data that the user must provide your own copy of the external database.</span>
<span class="sd">    &gt;&gt;&gt; # A step-by-step procedure for downloading the data can be found here: https://github.com/spatialucr/geosnap/blob/master/examples/01_getting_started.ipynb</span>
<span class="sd">    &gt;&gt;&gt; # After the user download the LTDB_Std_All_fullcount.zip and extract the files, the filepath might be something like presented below.</span>
<span class="sd">    &gt;&gt;&gt; filepath = &#39;~/data/LTDB_Std_2010_fullcount.csv&#39;</span>
<span class="sd">    &gt;&gt;&gt; census_2010 = pd.read_csv(filepath, encoding = &quot;ISO-8859-1&quot;, sep = &quot;,&quot;)</span>
<span class="sd">    </span>
<span class="sd">    Then, we filter only for the desired county (in this case, Riverside County):</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; df = census_2010.loc[census_2010.county == &quot;Riverside County&quot;][[&#39;pop10&#39;,&#39;tractid&#39;]]</span>
<span class="sd">    </span>
<span class="sd">    The value is estimated below.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; conprof_index = ConProf(df, &#39;tractid&#39;, &#39;pop10&#39;)</span>
<span class="sd">    &gt;&gt;&gt; conprof_index.statistic</span>
<span class="sd">    0.06393365660089256</span>
<span class="sd">    </span>
<span class="sd">    You can plot the profile curve with the plot method.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; conprof_index.plot()</span>
<span class="sd">        </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Based on Hong, Seong-Yun, and Yukio Sadahiro. &quot;Measuring geographic segregation: a graph-based approach.&quot; Journal of Geographical Systems 16.2 (2014): 211-231.</span>
<span class="sd">    </span>
<span class="sd">    Reference: :cite:`hong2014measuring`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ConProf.__init__"><a class="viewcode-back" href="../../../generated/segregation.aspatial.ConProf.html#segregation.aspatial.ConProf.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">):</span>        
        
        <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">_geometry_column_name</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">]])</span>
        
        <span class="n">aux</span> <span class="o">=</span> <span class="n">_conprof</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statistic</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span>      <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curve</span>     <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_function</span> <span class="o">=</span> <span class="n">_conprof</span></div>

<div class="viewcode-block" id="ConProf.plot"><a class="viewcode-back" href="../../../generated/segregation.aspatial.ConProf.html#segregation.aspatial.ConProf.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the Concentration Profile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;This method relies on importing `matplotlib`&#39;</span><span class="p">)</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">curve</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">graph</span></div></div>
    
    
    
    
<span class="k">def</span> <span class="nf">_modified_dissim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">iterations</span> <span class="o">=</span> <span class="mi">500</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculation of Modified Dissimilarity index</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>
<span class="sd">                    </span>
<span class="sd">    iterations    : int</span>
<span class="sd">                    The number of iterations the evaluate average classic dissimilarity under eveness. Default value is 500.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>

<span class="sd">    statistic : float</span>
<span class="sd">                Modified Dissimilarity Index (Dissimilarity from Carrington and Troske (1997))</span>
<span class="sd">                </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate. </span>
<span class="sd">                </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Based on Carrington, William J., and Kenneth R. Troske. &quot;On measuring segregation in samples with small units.&quot; Journal of Business &amp; Economic Statistics 15.4 (1997): 402-409.</span>
<span class="sd">    </span>
<span class="sd">    Reference: :cite:`carrington1997measuring`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">iterations</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;iterations must be an integer&#39;</span><span class="p">)</span>
        
    <span class="k">if</span><span class="p">(</span><span class="n">iterations</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;iterations must be greater than 1.&#39;</span><span class="p">)</span>
   
    <span class="n">D</span> <span class="o">=</span> <span class="n">_dissim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">group_pop_var</span><span class="p">:</span> <span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> 
                                <span class="n">total_pop_var</span><span class="p">:</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">})</span>
    
    <span class="c1"># core_data has to be in the beggining of the call because assign methods will be used later</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">!=</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">]]</span>
    
    <span class="k">else</span><span class="p">:</span>    
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">group_pop_var</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">total_pop_var</span><span class="p">)</span>
    
    <span class="n">p_null</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">t</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    
    <span class="n">Ds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">iterations</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">)):</span>

        <span class="n">freq_sim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]),</span> 
                                      <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">p_null</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]),</span> 
                                      <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">group_pop_var</span> <span class="o">=</span> <span class="n">freq_sim</span><span class="p">)</span>
        <span class="n">aux</span> <span class="o">=</span> <span class="n">_dissim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Ds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">aux</span>
        
    <span class="n">D_star</span> <span class="o">=</span> <span class="n">Ds</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">D</span> <span class="o">&gt;=</span> <span class="n">D_star</span><span class="p">):</span>
        <span class="n">Dct</span> <span class="o">=</span> <span class="p">(</span><span class="n">D</span> <span class="o">-</span> <span class="n">D_star</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">D_star</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Dct</span> <span class="o">=</span> <span class="p">(</span><span class="n">D</span> <span class="o">-</span> <span class="n">D_star</span><span class="p">)</span><span class="o">/</span><span class="n">D_star</span>
    
    <span class="k">return</span> <span class="n">Dct</span><span class="p">,</span> <span class="n">core_data</span>


<div class="viewcode-block" id="ModifiedDissim"><a class="viewcode-back" href="../../../generated/segregation.aspatial.ModifiedDissim.html#segregation.aspatial.ModifiedDissim">[docs]</a><span class="k">class</span> <span class="nc">ModifiedDissim</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculation of Modified Dissimilarity index</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>
<span class="sd">                    </span>
<span class="sd">    iterations    : int</span>
<span class="sd">                    The number of iterations the evaluate average classic dissimilarity under eveness. Default value is 500.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    statistic : float</span>
<span class="sd">                Modified Dissimilarity Index (Dissimilarity from Carrington and Troske (1997))</span>
<span class="sd">                </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate.    </span>
<span class="sd">                </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    In this example, we will calculate the Modified Dissimilarity Index (Dct) for the Riverside County using the census tract data of 2010.</span>
<span class="sd">    The group of interest is non-hispanic black people which is the variable nhblk10 in the dataset.</span>
<span class="sd">    </span>
<span class="sd">    Firstly, we need to perform some import the modules and the respective function.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; import geopandas as gpd</span>
<span class="sd">    &gt;&gt;&gt; import segregation</span>
<span class="sd">    &gt;&gt;&gt; from segregation.aspatial import ModifiedDissim</span>
<span class="sd">    </span>
<span class="sd">    Secondly, we need to read the data:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; # This example uses all census data that the user must provide your own copy of the external database.</span>
<span class="sd">    &gt;&gt;&gt; # A step-by-step procedure for downloading the data can be found here: https://github.com/spatialucr/geosnap/blob/master/examples/01_getting_started.ipynb</span>
<span class="sd">    &gt;&gt;&gt; # After the user download the LTDB_Std_All_fullcount.zip and extract the files, the filepath might be something like presented below.</span>
<span class="sd">    &gt;&gt;&gt; filepath = &#39;~/data/LTDB_Std_2010_fullcount.csv&#39;</span>
<span class="sd">    &gt;&gt;&gt; census_2010 = pd.read_csv(filepath, encoding = &quot;ISO-8859-1&quot;, sep = &quot;,&quot;)</span>
<span class="sd">    </span>
<span class="sd">    Then, we filter only for the desired county (in this case, Riverside County):</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; df = census_2010.loc[census_2010.county == &quot;Riverside County&quot;][[&#39;pop10&#39;,&#39;tractid&#39;]]</span>
<span class="sd">    </span>
<span class="sd">    The value is estimated below.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; np.random.seed(1234)</span>
<span class="sd">    &gt;&gt;&gt; modified_dissim_index = ModifiedDissim(df, &#39;tractid&#39;, &#39;pop10&#39;)</span>
<span class="sd">    &gt;&gt;&gt; modified_dissim_index.statistic</span>
<span class="sd">    0.30009504639081996</span>
<span class="sd">     </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Based on Carrington, William J., and Kenneth R. Troske. &quot;On measuring segregation in samples with small units.&quot; Journal of Business &amp; Economic Statistics 15.4 (1997): 402-409.</span>

<span class="sd">    Reference: :cite:`carrington1997measuring`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ModifiedDissim.__init__"><a class="viewcode-back" href="../../../generated/segregation.aspatial.ModifiedDissim.html#segregation.aspatial.ModifiedDissim.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">iterations</span> <span class="o">=</span> <span class="mi">500</span><span class="p">):</span>        
        
        <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">_geometry_column_name</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">]])</span>
        
        <span class="n">aux</span> <span class="o">=</span> <span class="n">_modified_dissim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">iterations</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statistic</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_function</span> <span class="o">=</span> <span class="n">_modified_dissim</span></div></div>
        
        
<span class="k">def</span> <span class="nf">_modified_gini_seg</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">iterations</span> <span class="o">=</span> <span class="mi">500</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculation of Modified Gini Segregation index</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>
<span class="sd">                    </span>
<span class="sd">    iterations    : int</span>
<span class="sd">                    The number of iterations the evaluate average classic gini segregation under eveness. Default value is 500.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>

<span class="sd">    statistic : float</span>
<span class="sd">                Modified Gini Segregation Index (Gini from Carrington and Troske (1997))</span>
<span class="sd">                </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate. </span>
<span class="sd">                </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Based on Carrington, William J., and Kenneth R. Troske. &quot;On measuring segregation in samples with small units.&quot; Journal of Business &amp; Economic Statistics 15.4 (1997): 402-409.</span>
<span class="sd">    </span>
<span class="sd">    Reference: :cite:`carrington1997measuring`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">iterations</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;iterations must be an integer&#39;</span><span class="p">)</span>
        
    <span class="k">if</span><span class="p">(</span><span class="n">iterations</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;iterations must be greater than 1.&#39;</span><span class="p">)</span>
   
    <span class="n">G</span> <span class="o">=</span> <span class="n">_gini_seg</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">group_pop_var</span><span class="p">:</span> <span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> 
                                <span class="n">total_pop_var</span><span class="p">:</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">})</span>
    
    <span class="c1"># core_data has to be in the beggining of the call because assign methods will be used later</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">!=</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">]]</span>
    
    <span class="k">else</span><span class="p">:</span>    
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">group_pop_var</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">total_pop_var</span><span class="p">)</span>
    
    <span class="n">p_null</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">t</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    
    <span class="n">Gs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">iterations</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">)):</span>

        <span class="n">freq_sim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]),</span> 
                                      <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">p_null</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]),</span> 
                                      <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">group_pop_var</span> <span class="o">=</span> <span class="n">freq_sim</span><span class="p">)</span>
        <span class="n">aux</span> <span class="o">=</span> <span class="n">_gini_seg</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Gs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">aux</span>
        
    <span class="n">G_star</span> <span class="o">=</span> <span class="n">Gs</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">G</span> <span class="o">&gt;=</span> <span class="n">G_star</span><span class="p">):</span>
        <span class="n">Gct</span> <span class="o">=</span> <span class="p">(</span><span class="n">G</span> <span class="o">-</span> <span class="n">G_star</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">G_star</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Gct</span> <span class="o">=</span> <span class="p">(</span><span class="n">G</span> <span class="o">-</span> <span class="n">G_star</span><span class="p">)</span><span class="o">/</span><span class="n">G_star</span>

    <span class="k">return</span> <span class="n">Gct</span><span class="p">,</span> <span class="n">core_data</span>


<div class="viewcode-block" id="ModifiedGiniSeg"><a class="viewcode-back" href="../../../generated/segregation.aspatial.ModifiedGiniSeg.html#segregation.aspatial.ModifiedGiniSeg">[docs]</a><span class="k">class</span> <span class="nc">ModifiedGiniSeg</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculation of Modified Gini Segregation index</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>
<span class="sd">                    </span>
<span class="sd">    iterations    : int</span>
<span class="sd">                    The number of iterations the evaluate average classic gini segregation under eveness. Default value is 500.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    statistic : float</span>
<span class="sd">                Modified Gini Segregation Index (Gini from Carrington and Troske (1997))</span>
<span class="sd">                </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate.     </span>
<span class="sd">                </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    In this example, we will calculate the Modified Gini Segregation Index (Gct) for the Riverside County using the census tract data of 2010.</span>
<span class="sd">    The group of interest is non-hispanic black people which is the variable nhblk10 in the dataset.</span>
<span class="sd">    </span>
<span class="sd">    Firstly, we need to perform some import the modules and the respective function.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; import geopandas as gpd</span>
<span class="sd">    &gt;&gt;&gt; import segregation</span>
<span class="sd">    &gt;&gt;&gt; from segregation.aspatial import ModifiedGiniSeg</span>
<span class="sd">    </span>
<span class="sd">    Secondly, we need to read the data:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; # This example uses all census data that the user must provide your own copy of the external database.</span>
<span class="sd">    &gt;&gt;&gt; # A step-by-step procedure for downloading the data can be found here: https://github.com/spatialucr/geosnap/blob/master/examples/01_getting_started.ipynb</span>
<span class="sd">    &gt;&gt;&gt; # After the user download the LTDB_Std_All_fullcount.zip and extract the files, the filepath might be something like presented below.</span>
<span class="sd">    &gt;&gt;&gt; filepath = &#39;~/data/LTDB_Std_2010_fullcount.csv&#39;</span>
<span class="sd">    &gt;&gt;&gt; census_2010 = pd.read_csv(filepath, encoding = &quot;ISO-8859-1&quot;, sep = &quot;,&quot;)</span>
<span class="sd">    </span>
<span class="sd">    Then, we filter only for the desired county (in this case, Riverside County):</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; df = census_2010.loc[census_2010.county == &quot;Riverside County&quot;][[&#39;pop10&#39;,&#39;tractid&#39;]]</span>
<span class="sd">    </span>
<span class="sd">    The value is estimated below.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; np.random.seed(1234)</span>
<span class="sd">    &gt;&gt;&gt; modified_gini_seg_index = ModifiedGiniSeg(df, &#39;tractid&#39;, &#39;pop10&#39;)</span>
<span class="sd">    &gt;&gt;&gt; modified_gini_seg_index.statistic</span>
<span class="sd">    0.4280279611418648</span>
<span class="sd">     </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Based on Carrington, William J., and Kenneth R. Troske. &quot;On measuring segregation in samples with small units.&quot; Journal of Business &amp; Economic Statistics 15.4 (1997): 402-409.</span>
<span class="sd">    </span>
<span class="sd">    Reference: :cite:`carrington1997measuring`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ModifiedGiniSeg.__init__"><a class="viewcode-back" href="../../../generated/segregation.aspatial.ModifiedGiniSeg.html#segregation.aspatial.ModifiedGiniSeg.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">iterations</span> <span class="o">=</span> <span class="mi">500</span><span class="p">):</span>        
        
        <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">_geometry_column_name</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">]])</span>
        
        <span class="n">aux</span> <span class="o">=</span> <span class="n">_modified_gini_seg</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">iterations</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statistic</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_function</span> <span class="o">=</span> <span class="n">_modified_gini_seg</span></div></div>
        
        
        
        
<span class="k">def</span> <span class="nf">_bias_corrected_dissim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="mi">500</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculation of Bias Corrected Dissimilarity index</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>
<span class="sd">                    </span>
<span class="sd">    B             : int</span>
<span class="sd">                    The number of iterations to calculate Dissimilarity simulating randomness with multinomial distributions. Default value is 500.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>

<span class="sd">    statistic : float</span>
<span class="sd">                Dissimilarity with Bias-Correction (bias correction from Allen, Rebecca et al. (2015))</span>
<span class="sd">                </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate. </span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Based on Allen, Rebecca, et al. &quot;More reliable inference for the dissimilarity index of segregation.&quot; The econometrics journal 18.1 (2015): 40-66.</span>
<span class="sd">    </span>
<span class="sd">    Reference: :cite:`allen2015more`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;B must be an integer&#39;</span><span class="p">)</span>
        
    <span class="k">if</span><span class="p">(</span><span class="n">B</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;B must be greater than 1.&#39;</span><span class="p">)</span>
   
    <span class="n">D</span> <span class="o">=</span> <span class="n">_dissim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">group_pop_var</span><span class="p">:</span> <span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> 
                                <span class="n">total_pop_var</span><span class="p">:</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">})</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">group_pop_var</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">total_pop_var</span><span class="p">)</span>
    
    <span class="n">other_group_pop</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">x</span>
    
    <span class="c1"># Group 0: minority group</span>
    <span class="n">p0_i</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">n0</span>   <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">sim0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multinomial</span><span class="p">(</span><span class="n">n0</span><span class="p">,</span> <span class="n">p0_i</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">B</span><span class="p">)</span>
    
    <span class="c1"># Group 1: complement group</span>
    <span class="n">p1_i</span> <span class="o">=</span> <span class="n">other_group_pop</span> <span class="o">/</span> <span class="n">other_group_pop</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">n1</span>   <span class="o">=</span> <span class="n">other_group_pop</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">sim1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multinomial</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">p1_i</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">B</span><span class="p">)</span>

    
    <span class="n">Dbcs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">B</span><span class="p">)):</span>
        <span class="n">data_aux</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;simul_group&#39;</span><span class="p">:</span> <span class="n">sim0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="s1">&#39;simul_tot&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">sim0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">sim1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()}</span>
        <span class="n">df_aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data_aux</span><span class="p">)</span>
        <span class="n">Dbcs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_dissim</span><span class="p">(</span><span class="n">df_aux</span><span class="p">,</span> <span class="s1">&#39;simul_group&#39;</span><span class="p">,</span> <span class="s1">&#39;simul_tot&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
    <span class="n">Db</span> <span class="o">=</span> <span class="n">Dbcs</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    
    <span class="n">Dbc</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">D</span> <span class="o">-</span> <span class="n">Db</span>
    <span class="n">Dbc</span> <span class="c1"># It expected to be lower than D, because D is upwarded biased</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">!=</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">]]</span>
    
    <span class="k">else</span><span class="p">:</span>    
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
        
    <span class="k">return</span> <span class="n">Dbc</span><span class="p">,</span> <span class="n">core_data</span>


<div class="viewcode-block" id="BiasCorrectedDissim"><a class="viewcode-back" href="../../../generated/segregation.aspatial.BiasCorrectedDissim.html#segregation.aspatial.BiasCorrectedDissim">[docs]</a><span class="k">class</span> <span class="nc">BiasCorrectedDissim</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculation of Bias Corrected Dissimilarity index</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>
<span class="sd">                    </span>
<span class="sd">    B             : int</span>
<span class="sd">                    The number of iterations to calculate Dissimilarity simulating randomness with multinomial distributions. Default value is 500.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    statistic : float</span>
<span class="sd">                Dissimilarity with Bias-Correction (bias correction from Allen, Rebecca et al. (2015))</span>
<span class="sd">                </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate. </span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    In this example, we will calculate the Dissimilarity with Bias Correction (Dbc) for the Riverside County using the census tract data of 2010.</span>
<span class="sd">    The group of interest is non-hispanic black people which is the variable nhblk10 in the dataset.</span>
<span class="sd">    </span>
<span class="sd">    Firstly, we need to perform some import the modules and the respective function.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; import geopandas as gpd</span>
<span class="sd">    &gt;&gt;&gt; import segregation</span>
<span class="sd">    &gt;&gt;&gt; from segregation.aspatial import BiasCorrectedDissim</span>
<span class="sd">    </span>
<span class="sd">    Secondly, we need to read the data:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; # This example uses all census data that the user must provide your own copy of the external database.</span>
<span class="sd">    &gt;&gt;&gt; # A step-by-step procedure for downloading the data can be found here: https://github.com/spatialucr/geosnap/blob/master/examples/01_getting_started.ipynb</span>
<span class="sd">    &gt;&gt;&gt; # After the user download the LTDB_Std_All_fullcount.zip and extract the files, the filepath might be something like presented below.</span>
<span class="sd">    &gt;&gt;&gt; filepath = &#39;~/data/LTDB_Std_2010_fullcount.csv&#39;</span>
<span class="sd">    &gt;&gt;&gt; census_2010 = pd.read_csv(filepath, encoding = &quot;ISO-8859-1&quot;, sep = &quot;,&quot;)</span>
<span class="sd">    </span>
<span class="sd">    Then, we filter only for the desired county (in this case, Riverside County):</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; df = census_2010.loc[census_2010.county == &quot;Riverside County&quot;][[&#39;pop10&#39;,&#39;tractid&#39;]]</span>
<span class="sd">    </span>
<span class="sd">    The value is estimated below.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; np.random.seed(1234)</span>
<span class="sd">    &gt;&gt;&gt; bias_corrected_dissim_index = BiasCorrectedDissim(df, &#39;tractid&#39;, &#39;pop10&#39;)</span>
<span class="sd">    &gt;&gt;&gt; bias_corrected_dissim_index.statistic</span>
<span class="sd">    0.31484636081876954</span>
<span class="sd">     </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Based on Allen, Rebecca, et al. &quot;More reliable inference for the dissimilarity index of segregation.&quot; The econometrics journal 18.1 (2015): 40-66.</span>
<span class="sd">    </span>
<span class="sd">    Reference: :cite:`allen2015more`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="BiasCorrectedDissim.__init__"><a class="viewcode-back" href="../../../generated/segregation.aspatial.BiasCorrectedDissim.html#segregation.aspatial.BiasCorrectedDissim.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="mi">500</span><span class="p">):</span>        
        
        <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">_geometry_column_name</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">]])</span>
        
        <span class="n">aux</span> <span class="o">=</span> <span class="n">_bias_corrected_dissim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statistic</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_function</span> <span class="o">=</span> <span class="n">_bias_corrected_dissim</span></div></div>
        
        
<span class="k">def</span> <span class="nf">_density_corrected_dissim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">xtol</span> <span class="o">=</span> <span class="mf">1e-5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculation of Density Corrected Dissimilarity index</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>
<span class="sd">    </span>
<span class="sd">    xtol          : float</span>
<span class="sd">                    The degree of tolerance in the optimization process of returning optimal theta_j</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>

<span class="sd">    statistic : float</span>
<span class="sd">                Dissimilarity with Density-Correction (density correction from Allen, Rebecca et al. (2015))</span>
<span class="sd">                </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate. </span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Based on Allen, Rebecca, et al. &quot;More reliable inference for the dissimilarity index of segregation.&quot; The econometrics journal 18.1 (2015): 40-66.</span>
<span class="sd">    </span>
<span class="sd">    Reference: :cite:`allen2015more`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span><span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">group_pop_var</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">total_pop_var</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;group_pop_var and total_pop_var must be strings&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">((</span><span class="n">group_pop_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">total_pop_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>    
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;group_pop_var and total_pop_var must be variables of data&#39;</span><span class="p">)</span>
        
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">group_pop_var</span><span class="p">:</span> <span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> 
                                <span class="n">total_pop_var</span><span class="p">:</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">})</span>
    
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">group_pop_var</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">total_pop_var</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="n">g</span><span class="p">):</span>    
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Group of interest population must equal or lower than the total population of the units.&#39;</span><span class="p">)</span>
    
    <span class="n">other_group_pop</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">g</span>
    
    <span class="c1"># Group 0: minority group</span>
    <span class="n">p0_i</span> <span class="o">=</span> <span class="n">g</span> <span class="o">/</span> <span class="n">g</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">n0</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    
    <span class="c1"># Group 1: complement group</span>
    <span class="n">p1_i</span> <span class="o">=</span> <span class="n">other_group_pop</span> <span class="o">/</span> <span class="n">other_group_pop</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="n">other_group_pop</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    
    <span class="n">sigma_hat_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">p1_i</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p1_i</span><span class="p">))</span> <span class="o">/</span> <span class="n">n1</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">p0_i</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p0_i</span><span class="p">))</span> <span class="o">/</span> <span class="n">n0</span><span class="p">))</span>
    <span class="n">theta_hat_j</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p1_i</span> <span class="o">-</span> <span class="n">p0_i</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma_hat_j</span>
    
    <span class="c1"># Constructing function that returns $n(\hat{\theta}_j)$</span>
    <span class="k">def</span> <span class="nf">return_optimal_theta</span><span class="p">(</span><span class="n">theta_j</span><span class="p">):</span>
        
        <span class="k">def</span> <span class="nf">fold_norm</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">theta_j</span><span class="p">)</span> <span class="o">+</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">theta_j</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">y</span>
        
        <span class="n">initial_guesses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">fold_norm</span><span class="p">,</span> 
                       <span class="n">initial_guesses</span><span class="p">,</span> 
                       <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nelder-mead&#39;</span><span class="p">,</span>
                       <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xtol&#39;</span><span class="p">:</span> <span class="n">xtol</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">final_simplex</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        
    <span class="n">optimal_thetas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">theta_hat_j</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">return_optimal_theta</span><span class="p">)</span>

    <span class="n">Ddc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">sigma_hat_j</span><span class="p">,</span> <span class="n">optimal_thetas</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">!=</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">]]</span>
    
    <span class="k">else</span><span class="p">:</span>    
        <span class="n">core_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;group_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;total_pop_var&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
    
    <span class="k">return</span> <span class="n">Ddc</span><span class="p">,</span> <span class="n">core_data</span>


<div class="viewcode-block" id="DensityCorrectedDissim"><a class="viewcode-back" href="../../../generated/segregation.aspatial.DensityCorrectedDissim.html#segregation.aspatial.DensityCorrectedDissim">[docs]</a><span class="k">class</span> <span class="nc">DensityCorrectedDissim</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculation of Density Corrected Dissimilarity index</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data          : a pandas DataFrame</span>
<span class="sd">    </span>
<span class="sd">    group_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the population size of the group of interest</span>
<span class="sd">                    </span>
<span class="sd">    total_pop_var : string</span>
<span class="sd">                    The name of variable in data that contains the total population of the unit</span>
<span class="sd">                    </span>
<span class="sd">    xtol          : float</span>
<span class="sd">                    The degree of tolerance in the optimization process of returning optimal theta_j</span>
<span class="sd">                                  </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    statistic : float</span>
<span class="sd">                Dissimilarity with Density-Correction (density correction from Allen, Rebecca et al. (2015))</span>
<span class="sd">                </span>
<span class="sd">    core_data : a pandas DataFrame</span>
<span class="sd">                A pandas DataFrame that contains the columns used to perform the estimate. </span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    In this example, we will calculate the Dissimilarity with Density Correction (Ddc) for the Riverside County using the census tract data of 2010.</span>
<span class="sd">    The group of interest is non-hispanic black people which is the variable nhblk10 in the dataset.</span>
<span class="sd">    </span>
<span class="sd">    Firstly, we need to perform some import the modules and the respective function.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; import geopandas as gpd</span>
<span class="sd">    &gt;&gt;&gt; import segregation</span>
<span class="sd">    &gt;&gt;&gt; from segregation.aspatial import DensityCorrectedDissim</span>
<span class="sd">    </span>
<span class="sd">    Secondly, we need to read the data:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; # This example uses all census data that the user must provide your own copy of the external database.</span>
<span class="sd">    &gt;&gt;&gt; # A step-by-step procedure for downloading the data can be found here: https://github.com/spatialucr/geosnap/blob/master/examples/01_getting_started.ipynb</span>
<span class="sd">    &gt;&gt;&gt; # After the user download the LTDB_Std_All_fullcount.zip and extract the files, the filepath might be something like presented below.</span>
<span class="sd">    &gt;&gt;&gt; filepath = &#39;~/data/LTDB_Std_2010_fullcount.csv&#39;</span>
<span class="sd">    &gt;&gt;&gt; census_2010 = pd.read_csv(filepath, encoding = &quot;ISO-8859-1&quot;, sep = &quot;,&quot;)</span>
<span class="sd">    </span>
<span class="sd">    Then, we filter only for the desired county (in this case, Riverside County):</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; df = census_2010.loc[census_2010.county == &quot;Riverside County&quot;][[&#39;pop10&#39;,&#39;tractid&#39;]]</span>
<span class="sd">    </span>
<span class="sd">    The value is estimated below.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; density_corrected_dissim_index = DensityCorrectedDissim(df, &#39;tractid&#39;, &#39;pop10&#39;)</span>
<span class="sd">    &gt;&gt;&gt; density_corrected_dissim_index.statistic</span>
<span class="sd">    0.29350643204887517</span>
<span class="sd">     </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Based on Allen, Rebecca, et al. &quot;More reliable inference for the dissimilarity index of segregation.&quot; The econometrics journal 18.1 (2015): 40-66.</span>
<span class="sd">    </span>
<span class="sd">    Reference: :cite:`allen2015more`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DensityCorrectedDissim.__init__"><a class="viewcode-back" href="../../../generated/segregation.aspatial.DensityCorrectedDissim.html#segregation.aspatial.DensityCorrectedDissim.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">xtol</span> <span class="o">=</span> <span class="mf">1e-5</span><span class="p">):</span>        
        
        <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;&lt;class </span><span class="se">\&#39;</span><span class="s1">geopandas.geodataframe.GeoDataFrame</span><span class="se">\&#39;</span><span class="s1">&gt;&#39;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">_geometry_column_name</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_nan_handle</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">]])</span>
        
        <span class="n">aux</span> <span class="o">=</span> <span class="n">_density_corrected_dissim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_pop_var</span><span class="p">,</span> <span class="n">total_pop_var</span><span class="p">,</span> <span class="n">xtol</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statistic</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_function</span> <span class="o">=</span> <span class="n">_density_corrected_dissim</span></div></div>
        












<span class="c1"># Deprecation Calls</span>
        
<span class="n">msg</span> <span class="o">=</span> <span class="n">_dep_message</span><span class="p">(</span><span class="s2">&quot;Gini_Seg&quot;</span><span class="p">,</span> <span class="s2">&quot;GiniSeg&quot;</span><span class="p">)</span>
<span class="n">Gini_Seg</span> <span class="o">=</span> <span class="n">DeprecationHelper</span><span class="p">(</span><span class="n">GiniSeg</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>

<span class="n">msg</span> <span class="o">=</span> <span class="n">_dep_message</span><span class="p">(</span><span class="s2">&quot;Correlation_R&quot;</span><span class="p">,</span> <span class="s2">&quot;CorrelationR&quot;</span><span class="p">)</span>
<span class="n">Correlation_R</span> <span class="o">=</span> <span class="n">DeprecationHelper</span><span class="p">(</span><span class="n">CorrelationR</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>

<span class="n">msg</span> <span class="o">=</span> <span class="n">_dep_message</span><span class="p">(</span><span class="s2">&quot;Con_Prof&quot;</span><span class="p">,</span> <span class="s2">&quot;ConProf&quot;</span><span class="p">)</span>
<span class="n">Con_Prof</span> <span class="o">=</span> <span class="n">DeprecationHelper</span><span class="p">(</span><span class="n">ConProf</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>

<span class="n">msg</span> <span class="o">=</span> <span class="n">_dep_message</span><span class="p">(</span><span class="s2">&quot;Modified_Dissim&quot;</span><span class="p">,</span> <span class="s2">&quot;ModifiedDissim&quot;</span><span class="p">)</span>
<span class="n">Modified_Dissim</span> <span class="o">=</span> <span class="n">DeprecationHelper</span><span class="p">(</span><span class="n">ModifiedDissim</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>

<span class="n">msg</span> <span class="o">=</span> <span class="n">_dep_message</span><span class="p">(</span><span class="s2">&quot;Modified_Gini_Seg&quot;</span><span class="p">,</span> <span class="s2">&quot;ModifiedGiniSeg&quot;</span><span class="p">)</span>
<span class="n">Modified_Gini_Seg</span> <span class="o">=</span> <span class="n">DeprecationHelper</span><span class="p">(</span><span class="n">ModifiedGiniSeg</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>

<span class="n">msg</span> <span class="o">=</span> <span class="n">_dep_message</span><span class="p">(</span><span class="s2">&quot;Bias_Corrected_Dissim&quot;</span><span class="p">,</span> <span class="s2">&quot;BiasCorrectedDissim&quot;</span><span class="p">)</span>
<span class="n">Bias_Corrected_Dissim</span> <span class="o">=</span> <span class="n">DeprecationHelper</span><span class="p">(</span><span class="n">BiasCorrectedDissim</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>

<span class="n">msg</span> <span class="o">=</span> <span class="n">_dep_message</span><span class="p">(</span><span class="s2">&quot;Density_Corrected_Dissim&quot;</span><span class="p">,</span> <span class="s2">&quot;DensityCorrectedDissim&quot;</span><span class="p">)</span>
<span class="n">Density_Corrected_Dissim</span> <span class="o">=</span> <span class="n">DeprecationHelper</span><span class="p">(</span><span class="n">DensityCorrectedDissim</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2018, pysal developers.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.4.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>